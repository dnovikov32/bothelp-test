## Тестовое задание BotHelp

### Задача
Максимально быстрой разобрать очередь событий аккаунтов.  
События должны обрабатываться в порядке их поступления.  
Обработка события занимает 1 секунду (эмулировать с помощью sleep). 

### Описание решения
Для хранения всех событий используется FIFO очередь реализованная на Radis.

Для получения блокировки процессом используется переменная Redis mutex вида `lock:ID`.

Для правильного порядка разбора событий одного аккаунта используется переменная 
Redis `account:ID` содержащая массив всех ID событий аккаунта. 

При создании нового обработчика он получает событие из общей очереди 
и добавляет его в очередь событий аккаунта (переменная Redis содержащая массив ID событий).

При получении блокировки обработчик сортирует массив событий аккаунта по ID, 
сравнивает свое событие с первым в очереди и, если они совпадают, выполняет работу. 

### Запуск
В папке проекта выполнить:
```bash
$ make run
```
Запускает следующие команды:
- composer install
- generate_events.php для добавления событий в очередь
- main.php для запуска обработчиков

Результаты выполнения можно смотреть в файле **log/log.txt**

### Описание
**Redis commander**  
Доступен по адресу http://localhost:8081/  
Login: root  
Password: root  


**src/generate_events.php**  
Скрипт заполняет очередь `queue:events` событиями в количестве 10000.  
Для 1000 аккаунтов с ID от 1 до 1000 создаются события
в количестве от 1 до 10 с числовыми ID от 1 до 10.

Пример события: 
```json
{"accountId":460,"eventId":4}
```

**src/main.php**  
Запускает указанное количество обработчиков.

**src/worker.php**  
Обработчик события.

**log/log.txt**  
Файл с результатами выполнения


### Доступные команды
```bash
$ make docker-up        # Запустить все контейнеры
$ make docker-down      # Остановить все контейнеры
$ make docker-build     # Пересобрать контейнеры (например при изменении конфига nginx)
$ make docker-rebuild   # Пересобрать все контейнеры с нуля
$ make ssh-php          # Консоль php контейнера с приложением
$ make run              # Выполнить все задачи
``` 